Widget botonesInicio() {
    // ✅ Opción C: Home tipo “app de música” con secciones.
    // Mantiene EXACTAMENTE la misma lógica/callbacks.

    final t = Theme.of(context);

    // ✅ Contadores (ya calculados en _homeCounts)
    final all = _homeCounts['all'] ?? 0;
    final fav = _homeCounts['fav'] ?? 0;
    final wish = _homeCounts['wish'] ?? 0;

    Widget badge(int n) {
      return Container(
        padding: const EdgeInsets.symmetric(horizontal: 8, vertical: 4),
        decoration: BoxDecoration(
          color: Colors.black,
          borderRadius: BorderRadius.circular(999),
          border: Border.all(color: const Color(0xFF2A2A2A)),
        ),
        child: Text(
          '$n',
          style: const TextStyle(color: Colors.white, fontSize: 11, fontWeight: FontWeight.w900),
        ),
      );
    }

    Widget sectionTitle(String title, {String? subtitle}) {
      return Padding(
        padding: const EdgeInsets.only(top: 10, bottom: 8),
        child: Column(
          crossAxisAlignment: CrossAxisAlignment.start,
          children: [
            Text(title, style: t.textTheme.titleLarge),
            if (subtitle != null) ...[
              const SizedBox(height: 4),
              Text(
                subtitle,
                style: t.textTheme.bodySmall?.copyWith(color: const Color(0xFFA7A7A7), fontWeight: FontWeight.w600),
              ),
            ]
          ],
        ),
      );
    }

    Widget quickAction({required IconData icon, required String label, required VoidCallback onTap}) {
      return ActionChip(
        onPressed: onTap,
        label: Text(label, style: const TextStyle(fontWeight: FontWeight.w800)),
        avatar: Icon(icon, size: 18),
        backgroundColor: const Color(0xFF111111),
        side: const BorderSide(color: Color(0xFF2A2A2A)),
        shape: RoundedRectangleBorder(borderRadius: BorderRadius.circular(999)),
      );
    }

    Widget menuRow({required IconData icon, required String title, required String subtitle, int? count, required VoidCallback onTap}) {
      return Card(
        child: InkWell(
          onTap: onTap,
          borderRadius: BorderRadius.circular(16),
          child: Padding(
            padding: const EdgeInsets.symmetric(horizontal: 14, vertical: 12),
            child: Row(
              children: [
                Container(
                  width: 44,
                  height: 44,
                  decoration: BoxDecoration(
                    color: const Color(0xFF0F0F0F),
                    borderRadius: BorderRadius.circular(14),
                    border: Border.all(color: const Color(0xFF2A2A2A)),
                  ),
                  child: Icon(icon, size: 22, color: t.colorScheme.onSurface),
                ),
                const SizedBox(width: 12),
                Expanded(
                  child: Column(
                    crossAxisAlignment: CrossAxisAlignment.start,
                    children: [
                      Text(title, style: t.textTheme.titleMedium, maxLines: 1, overflow: TextOverflow.ellipsis),
                      const SizedBox(height: 2),
                      Text(
                        subtitle,
                        style: t.textTheme.bodySmall?.copyWith(color: const Color(0xFFA7A7A7)),
                        maxLines: 1,
                        overflow: TextOverflow.ellipsis,
                      ),
                    ],
                  ),
                ),
                if (count != null) ...[
                  const SizedBox(width: 10),
                  badge(count),
                ],
                const SizedBox(width: 8),
                const Icon(Icons.chevron_right, size: 20, color: Color(0xFFA7A7A7)),
              ],
            ),
          ),
        ),
      );
    }

    Widget recentGrid() {
      return FutureBuilder<List<Map<String, dynamic>>>(
        future: _futureAll,
        builder: (context, snap) {
          final items = (snap.data ?? const <Map<String, dynamic>>[]).toList();
          if (items.isEmpty) {
            return const Text(
              'Aún no has agregado vinilos. Usa “Buscar” o “Discografías”.',
              style: TextStyle(color: Color(0xFFA7A7A7), fontWeight: FontWeight.w600),
            );
          }

          // Mostramos 4 “últimos” de forma visual (sin cambiar lógica de guardado).
          items.sort((a, b) {
            final ia = (a['id'] is int) ? a['id'] as int : 0;
            final ib = (b['id'] is int) ? b['id'] as int : 0;
            return ib.compareTo(ia);
          });
          final top = items.take(4).toList();

          return GridView.builder(
            shrinkWrap: true,
            physics: const NeverScrollableScrollPhysics(),
            itemCount: top.length,
            gridDelegate: const SliverGridDelegateWithFixedCrossAxisCount(
              crossAxisCount: 2,
              crossAxisSpacing: 12,
              mainAxisSpacing: 12,
              childAspectRatio: 1.05,
            ),
            itemBuilder: (_, i) {
              final v = top[i];
              final artista = (v['artista'] as String?)?.trim() ?? '';
              final album = (v['album'] as String?)?.trim() ?? '';
              final year = (v['year'] as String?)?.trim() ?? '';

              return InkWell(
                onTap: () => _openDetail(v),
                borderRadius: BorderRadius.circular(16),
                child: Card(
                  clipBehavior: Clip.antiAlias,
                  child: Padding(
                    padding: const EdgeInsets.all(10),
                    child: Column(
                      crossAxisAlignment: CrossAxisAlignment.start,
                      children: [
                        Expanded(
                          child: ClipRRect(
                            borderRadius: BorderRadius.circular(12),
                            child: _gridCover(v),
                          ),
                        ),
                        const SizedBox(height: 8),
                        Text(
                          artista.isEmpty ? '—' : artista,
                          maxLines: 1,
                          overflow: TextOverflow.ellipsis,
                          style: const TextStyle(fontWeight: FontWeight.w800),
                        ),
                        Text(
                          album.isEmpty ? '—' : album,
                          maxLines: 1,
                          overflow: TextOverflow.ellipsis,
                          style: const TextStyle(color: Color(0xFFA7A7A7), fontWeight: FontWeight.w600),
                        ),
                        const SizedBox(height: 2),
                        Text(
                          year.isEmpty ? '—' : year,
                          style: const TextStyle(color: Color(0xFFA7A7A7), fontSize: 12, fontWeight: FontWeight.w600),
                        ),
                      ],
                    ),
                  ),
                ),
              );
            },
          );
        },
      );
    }

    return Column(
      crossAxisAlignment: CrossAxisAlignment.stretch,
      children: [
        const SizedBox(height: 6),

        // HERO
        Container(
          padding: const EdgeInsets.all(14),
          decoration: BoxDecoration(
            color: const Color(0xFF0F0F0F),
            borderRadius: BorderRadius.circular(18),
            border: Border.all(color: const Color(0xFF2A2A2A)),
          ),
          child: Column(
            crossAxisAlignment: CrossAxisAlignment.start,
            children: [
              Text('GaBoLP', style: t.textTheme.titleLarge?.copyWith(fontWeight: FontWeight.w900)),
              const SizedBox(height: 4),
              const Text(
                'Tu colección de vinilos, simple y rápida.',
                style: TextStyle(color: Color(0xFFA7A7A7), fontWeight: FontWeight.w600),
              ),
              const SizedBox(height: 10),
              Wrap(
                spacing: 8,
                runSpacing: 8,
                children: [
                  quickAction(icon: Icons.search, label: 'Buscar', onTap: () => setState(() => vista = Vista.buscar)),
                  quickAction(
                    icon: Icons.library_music,
                    label: 'Discografías',
                    onTap: () => Navigator.push(context, MaterialPageRoute(builder: (_) => const DiscographyScreen())),
                  ),
                  quickAction(
                    icon: Icons.settings,
                    label: 'Ajustes',
                    onTap: () => Navigator.push(context, MaterialPageRoute(builder: (_) => const SettingsScreen())),
                  ),
                ],
              ),
            ],
          ),
        ),

        sectionTitle('Colección', subtitle: 'Accede rápido a tus listas.'),
        menuRow(
          icon: Icons.list,
          title: 'Lista de vinilos',
          subtitle: 'Todos tus LPs guardados',
          count: all,
          onTap: () => setState(() => vista = Vista.lista),
        ),
        menuRow(
          icon: Icons.star,
          title: 'Vinilos favoritos',
          subtitle: 'Tu selección destacada',
          count: fav,
          onTap: () => setState(() => vista = Vista.favoritos),
        ),
        menuRow(
          icon: Icons.shopping_cart,
          title: 'Lista de deseos',
          subtitle: 'Pendientes por comprar',
          count: wish,
          onTap: () {
            Navigator.push(context, MaterialPageRoute(builder: (_) => const WishlistScreen())).then((_) {
              if (!mounted) return;
              _reloadAllData();
            });
          },
        ),
        menuRow(
          icon: Icons.delete_outline,
          title: 'Borrar vinilos',
          subtitle: 'Eliminar de tu lista',
          onTap: () => setState(() => vista = Vista.borrar),
        ),

        sectionTitle('Últimos agregados', subtitle: 'Acceso rápido a lo último que guardaste.'),
        recentGrid(),
        const SizedBox(height: 10),
      ],
    );
  }
